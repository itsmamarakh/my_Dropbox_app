{"ast":null,"code":"import _slicedToArray from\"/Users/student/Desktop/My_dropbox-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/Users/student/Desktop/My_dropbox-master/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useReducer,useEffect}from\"react\";import{database}from'./../../firebase';import{useAuth}from'./../store/AuthStore';var ACTIONS={SELECT_FOLDER:\"select-folder\",UPDATE_FOLDER:\"update-folder\",SET_CHILD_FOLDERS:\"set-child-folders\",SET_CHILD_FILES:\"set-child-files\"};export var ROOT_FOLDER={name:\"Home\",id:null,path:[]};var reducer=function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case ACTIONS.SELECT_FOLDER:return{folderId:payload.folderId,folder:payload.folder,childFiles:[],childFolders:[]};case ACTIONS.UPDATE_FOLDER:return _objectSpread(_objectSpread({},state),{},{folder:payload.folder});case ACTIONS.SET_CHILD_FOLDERS:return _objectSpread(_objectSpread({},state),{},{childFolders:payload.childFolders});case ACTIONS.SET_CHILD_FILES:return _objectSpread(_objectSpread({},state),{},{childFiles:payload.childFiles});default:return state;}};export var useFolder=function useFolder(){var folderId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var folder=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _useAuth=useAuth(),currentUser=_useAuth.currentUser;var _useReducer=useReducer(reducer,{folderId:folderId,folder:folder,childFolders:[],childFiles:[]}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];useEffect(function(){dispatch({type:ACTIONS.SELECT_FOLDER,payload:{folderId:folderId,folder:folder}});},[folderId,folder]);useEffect(function(){if(!folderId){return dispatch({type:ACTIONS.UPDATE_FOLDER,payload:{folder:ROOT_FOLDER}});}database.folders.doc(folderId).get().then(function(doc){dispatch({type:ACTIONS.UPDATE_FOLDER,payload:{folder:database.formatDoc(doc)}});}).catch(function(){dispatch({type:ACTIONS.UPDATE_FOLDER,payload:{folder:ROOT_FOLDER}});});},[folderId]);useEffect(function(){return database.folders.where(\"parentId\",\"==\",folderId).where(\"userId\",\"==\",currentUser.uid).orderBy(\"createdAt\").onSnapshot(function(snapshot){dispatch({type:ACTIONS.SET_CHILD_FOLDERS,payload:{childFolders:snapshot.docs.map(database.formatDoc)}});});},[folderId,currentUser]);useEffect(function(){return database.files.where(\"folderId\",\"==\",folderId).where(\"userId\",\"==\",currentUser.uid).onSnapshot(function(snapshot){dispatch({type:ACTIONS.SET_CHILD_FILES,payload:{childFiles:snapshot.docs.map(database.formatDoc)}});});},[folderId,currentUser]);return state;};","map":{"version":3,"names":["useReducer","useEffect","database","useAuth","ACTIONS","SELECT_FOLDER","UPDATE_FOLDER","SET_CHILD_FOLDERS","SET_CHILD_FILES","ROOT_FOLDER","name","id","path","reducer","state","type","payload","folderId","folder","childFiles","childFolders","useFolder","currentUser","dispatch","folders","doc","get","then","formatDoc","catch","where","uid","orderBy","onSnapshot","snapshot","docs","map","files"],"sources":["/Users/student/Desktop/My_dropbox-master/src/components/hooks/useFolder.js"],"sourcesContent":["import { useReducer, useEffect } from \"react\"\nimport { database } from './../../firebase';\nimport { useAuth } from './../store/AuthStore';\n\nconst ACTIONS = {\n    SELECT_FOLDER: \"select-folder\",\n    UPDATE_FOLDER: \"update-folder\",\n    SET_CHILD_FOLDERS: \"set-child-folders\",\n    SET_CHILD_FILES: \"set-child-files\"\n}\n\nexport const ROOT_FOLDER = {\n    name: \"Home\",\n    id: null,\n    path: []\n}\n\nconst reducer = (state, { type, payload }) => {\n    switch (type) {\n        case ACTIONS.SELECT_FOLDER:\n            return {\n                folderId: payload.folderId,\n                folder: payload.folder,\n                childFiles: [],\n                childFolders: []\n            }\n        case ACTIONS.UPDATE_FOLDER:\n            return {\n                ...state,\n                folder: payload.folder\n            }\n        case ACTIONS.SET_CHILD_FOLDERS:\n            return {\n                ...state,\n                childFolders: payload.childFolders\n            }\n        case ACTIONS.SET_CHILD_FILES:\n            return {\n                ...state,\n                childFiles: payload.childFiles\n            }\n        default:\n            return state;\n    }\n}\n\nexport const useFolder = (folderId = null, folder = null) => {\n    const { currentUser } = useAuth();\n    const [state, dispatch] = useReducer(reducer, {\n        folderId,\n        folder,\n        childFolders: [],\n        childFiles: []\n    });\n\n    useEffect(() => {\n        dispatch({ type: ACTIONS.SELECT_FOLDER, payload: { folderId, folder } })\n    }, [folderId, folder])\n\n    useEffect(() => {\n        if(!folderId) {\n            return dispatch({\n                type: ACTIONS.UPDATE_FOLDER,\n                payload: { folder: ROOT_FOLDER, }\n            })\n        }\n\n        database.folders.doc(folderId).get().then(doc => {\n            dispatch({\n                type: ACTIONS.UPDATE_FOLDER,\n                payload: { folder: database.formatDoc(doc), }\n            })\n        }).catch(() => {\n            dispatch({\n                type: ACTIONS.UPDATE_FOLDER,\n                payload: { folder: ROOT_FOLDER, }\n            })\n        })\n    }, [folderId])\n\n    useEffect(() => {\n        return database.folders\n            .where(\"parentId\", \"==\", folderId)\n            .where(\"userId\", \"==\", currentUser.uid)\n            .orderBy(\"createdAt\")\n            .onSnapshot(snapshot => {\n                dispatch({\n                    type: ACTIONS.SET_CHILD_FOLDERS,\n                    payload: { childFolders: snapshot.docs.map(database.formatDoc) }\n                })\n            })\n\n    }, [folderId, currentUser])\n\n    useEffect(() => {\n        return database.files\n            .where(\"folderId\", \"==\", folderId)\n            .where(\"userId\", \"==\", currentUser.uid)\n            .onSnapshot(snapshot => {\n                dispatch({\n                    type: ACTIONS.SET_CHILD_FILES,\n                    payload: { childFiles: snapshot.docs.map(database.formatDoc) }\n                })\n            })\n\n    }, [folderId, currentUser])\n\n    return state;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
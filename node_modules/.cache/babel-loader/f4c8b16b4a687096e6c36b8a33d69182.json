{"ast":null,"code":"var _jsxFileName = \"/Users/student/Desktop/My_dropbox-master/src/components/storage/AddFileBtn.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport ReactDOM from \"react-dom\";\nimport { ArrowUpTrayIcon } from '@heroicons/react/20/solid';\nimport { storage } from '../../firebase';\nimport { useAuth } from './../store/AuthStore';\nimport { ROOT_FOLDER } from './../hooks/useFolder';\nimport { database } from './../../firebase';\nimport { v4 as uuidV4 } from \"uuid\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst AddFileBtn = _ref => {\n  _s();\n\n  let {\n    currentFolder\n  } = _ref;\n  const [uplaodingFiles, setUploadingFiles] = useState([]);\n  const {\n    currentUser\n  } = useAuth();\n\n  const handleUpload = e => {\n    const file = e.target.files[0];\n    if (currentFolder === null || !file) return;\n    const id = uuidV4();\n    setUploadingFiles(prev => [...prev, {\n      id: id,\n      name: file.name,\n      progress: 0,\n      error: false\n    }]);\n    const currentPath = currentFolder.path.map(u => u.name).join('/');\n    const filePath = currentFolder === ROOT_FOLDER ? `${currentPath}/${file.name}` : `${currentPath}/${currentFolder.name}/${file.name}`;\n    const uploadTask = storage.ref(`/files/${currentUser.uid}/${filePath}`).put(file);\n    uploadTask.on(\"state-changed\", snapshot => {\n      const progress = snapshot.bytesTransferred / snapshot.totalBytes;\n      setUploadingFiles(prev => {\n        return prev.map(uploadFile => {\n          if (uploadFile.id === id) {\n            return { ...uploadFile,\n              progress: progress\n            };\n          }\n\n          return uploadFile;\n        });\n      });\n    }, () => {\n      setUploadingFiles(prev => {\n        return prev.map(uploadFile => {\n          if (uploadFile.id === id) {\n            return { ...uploadFile,\n              error: true\n            };\n          }\n\n          return uploadFile;\n        });\n      });\n    }, () => {\n      setUploadingFiles(prev => {\n        return prev.filter(uploadFile => uploadFile.id !== id);\n      });\n      uploadTask.snapshot.ref.getDownloadURL().then(url => {\n        database.files.where(\"name\", \"==\", file.name).where(\"userId\", \"==\", currentUser.uid).where(\"folderId\", \"==\", currentFolder.id).get().then(existingFiles => {\n          const existingFile = existingFiles.docs[0];\n\n          if (existingFile) {\n            existingFile.ref.update({\n              url: url\n            });\n          } else {\n            database.files.add({\n              url: url,\n              name: file.name,\n              createdAt: database.getCurrentTimestamp(),\n              folderId: currentFolder.id,\n              userId: currentUser.uid\n            });\n          }\n        });\n      });\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"ml-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-dark rounded flex items-center px-4 py-1 w-full font-base bg-blue-200 hover:bg-stone-900 hover:text-white py-3 px-5 cursor-pointer\",\n        children: [/*#__PURE__*/_jsxDEV(ArrowUpTrayIcon, {\n          className: \"h-5 w-5 mr-1\",\n          \"aria-hidden\": \"true\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }, this), \"Upload\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        onChange: handleUpload,\n        style: {\n          display: \"none\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }, this), uplaodingFiles.length > 0 && /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-black border rounded-lg p-2 text-white\",\n      style: {\n        position: \"absolute\",\n        bottom: \"1rem\",\n        right: \"calc(50% - 350px / 2)\",\n        width: \"350px\"\n      },\n      children: uplaodingFiles.length > 0 && uplaodingFiles.map(file => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center mb-4\",\n          children: /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: file.error ? \"text-red-800 font-medium text-lg\" : \"font-medium text-lg\",\n            children: file.error ? `Error uploading file ${file.name}` : file.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full bg-gray-200 rounded-full dark:bg-gray-700\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${file.error ? \"bg-red-800\" : \"bg-blue-600\"} text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full`,\n            style: {\n              width: `${Math.round(file.progress * 100)}%`\n            },\n            children: `${Math.round(file.progress * 100)}%`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 33\n        }, this)]\n      }, file.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 29\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 21\n    }, this), document.body)]\n  }, void 0, true);\n};\n\n_s(AddFileBtn, \"7KxQxLbjAXnoMeedWwBeAF1VBts=\", false, function () {\n  return [useAuth];\n});\n\n_c = AddFileBtn;\nexport default AddFileBtn;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddFileBtn\");","map":{"version":3,"names":["React","useEffect","useState","ReactDOM","ArrowUpTrayIcon","storage","useAuth","ROOT_FOLDER","database","v4","uuidV4","AddFileBtn","currentFolder","uplaodingFiles","setUploadingFiles","currentUser","handleUpload","e","file","target","files","id","prev","name","progress","error","currentPath","path","map","u","join","filePath","uploadTask","ref","uid","put","on","snapshot","bytesTransferred","totalBytes","uploadFile","filter","getDownloadURL","then","url","where","get","existingFiles","existingFile","docs","update","add","createdAt","getCurrentTimestamp","folderId","userId","display","length","createPortal","position","bottom","right","width","Math","round","document","body"],"sources":["/Users/student/Desktop/My_dropbox-master/src/components/storage/AddFileBtn.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport ReactDOM  from \"react-dom\";\nimport { ArrowUpTrayIcon } from '@heroicons/react/20/solid';\nimport { storage } from '../../firebase';\nimport { useAuth } from './../store/AuthStore';\nimport { ROOT_FOLDER } from './../hooks/useFolder';\nimport { database } from './../../firebase';\nimport { v4 as uuidV4 } from \"uuid\";\n\nconst AddFileBtn = ({ currentFolder }) => {\n    const [uplaodingFiles, setUploadingFiles] = useState([]);\n    const { currentUser } = useAuth();\n\n    const handleUpload = (e) => {\n        const file = e.target.files[0];\n\n        if(currentFolder === null || !file) return;\n\n        const id = uuidV4();\n        setUploadingFiles(prev => [\n            ...prev,\n            { id: id, name: file.name, progress: 0, error: false }\n        ])\n\n        const currentPath = currentFolder.path.map(u => u.name).join('/');\n\n        const filePath =\n            currentFolder === ROOT_FOLDER\n                ?\n                    `${currentPath}/${file.name}`\n                :\n                    `${currentPath}/${currentFolder.name}/${file.name}`\n\n\n        const uploadTask = storage\n            .ref(`/files/${currentUser.uid}/${filePath}`)\n            .put(file);\n\n\n        uploadTask.on(\"state-changed\", snapshot => {\n            const progress = snapshot.bytesTransferred / snapshot.totalBytes;\n            setUploadingFiles(prev => {\n                return prev.map(uploadFile => {\n                    if(uploadFile.id === id) {\n                        return { ...uploadFile, progress: progress }\n                    }\n\n                    return uploadFile;\n                })\n            });\n        },\n        () => {\n            setUploadingFiles(prev => {\n                return prev.map(uploadFile => {\n                    if(uploadFile.id === id) {\n                        return { ...uploadFile, error: true }\n                    }\n\n                    return uploadFile;\n                })\n            })\n        },\n        () => {\n            setUploadingFiles(prev => {\n                return prev.filter(uploadFile => uploadFile.id !== id)\n            });\n\n            uploadTask.snapshot.ref.getDownloadURL().then(url => {\n                database.files\n                    .where(\"name\", \"==\", file.name)\n                    .where(\"userId\", \"==\", currentUser.uid)\n                    .where(\"folderId\", \"==\", currentFolder.id)\n                    .get()\n                    .then(existingFiles => {\n                        const existingFile = existingFiles.docs[0];\n                        if(existingFile) {\n                            existingFile.ref.update({ url: url  });\n                        } else {\n                            database.files.add({\n                                url: url,\n                                name: file.name,\n                                createdAt: database.getCurrentTimestamp(),\n                                folderId: currentFolder.id,\n                                userId: currentUser.uid\n                            })\n                        }\n                    })\n            })\n        })\n    }\n\n    return (\n        <>\n            <label className=\"ml-4\">\n                <div className=\"text-dark rounded flex items-center px-4 py-1 w-full font-base bg-blue-200 hover:bg-stone-900 hover:text-white py-3 px-5 cursor-pointer\">\n                    <ArrowUpTrayIcon\n                        className=\"h-5 w-5 mr-1\"\n                        aria-hidden=\"true\"\n                    />\n                    Upload\n                </div>\n                <input\n                    type=\"file\"\n                    onChange={handleUpload}\n                    style={{display: \"none\"}}\n                />\n            </label>\n            {   uplaodingFiles.length > 0 &&\n                ReactDOM.createPortal((\n                    <div className=\"bg-black border rounded-lg p-2 text-white\" style={{\n                        position: \"absolute\",\n                        bottom: \"1rem\",\n                        right: \"calc(50% - 350px / 2)\",\n                        width: \"350px\"\n                    }}>\n                        { uplaodingFiles.length > 0 && uplaodingFiles.map(file => (\n                            <div className=\"\" key={file.id}>\n                                <div className=\"text-center mb-4\">\n                                    <h4 className={ file.error ? \"text-red-800 font-medium text-lg\" :  \"font-medium text-lg\"}>\n                                        { file.error ?  `Error uploading file ${file.name}` : file.name }\n                                    </h4>\n                                </div>\n                                <div className=\"w-full bg-gray-200 rounded-full dark:bg-gray-700\">\n                                    <div className={`${file.error ? \"bg-red-800\" : \"bg-blue-600\"} text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full` }\n                                    style={{\n                                        width: `${Math.round( file.progress * 100)}%`\n                                    }}>\n                                        { `${Math.round( file.progress * 100)}%` }\n                                    </div>\n                                </div>\n                            </div>\n                        )) }\n                    </div>\n                    ),\n                    document.body\n                )\n            }\n        </>\n    );\n};\n\nexport default AddFileBtn;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
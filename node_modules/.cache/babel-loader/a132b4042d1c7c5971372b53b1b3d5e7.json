{"ast":null,"code":"import _objectSpread from\"/Users/student/Desktop/My_dropbox-master/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/student/Desktop/My_dropbox-master/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/student/Desktop/My_dropbox-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import ReactDOM from\"react-dom\";import{ArrowUpTrayIcon}from'@heroicons/react/20/solid';import{storage}from'../../firebase';import{useAuth}from'./../store/AuthStore';import{ROOT_FOLDER}from'./../hooks/useFolder';import{database}from'./../../firebase';import{v4 as uuidV4}from\"uuid\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AddFileBtn=function AddFileBtn(_ref){var currentFolder=_ref.currentFolder;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),uplaodingFiles=_useState2[0],setUploadingFiles=_useState2[1];var _useAuth=useAuth(),currentUser=_useAuth.currentUser;var handleUpload=function handleUpload(e){var file=e.target.files[0];if(currentFolder===null||!file)return;var id=uuidV4();setUploadingFiles(function(prev){return[].concat(_toConsumableArray(prev),[{id:id,name:file.name,progress:0,error:false}]);});var currentPath=currentFolder.path.map(function(u){return u.name;}).join('/');var filePath=currentFolder===ROOT_FOLDER?\"\".concat(currentPath,\"/\").concat(file.name):\"\".concat(currentPath,\"/\").concat(currentFolder.name,\"/\").concat(file.name);var uploadTask=storage.ref(\"/files/\".concat(currentUser.uid,\"/\").concat(filePath)).put(file);uploadTask.on(\"state-changed\",function(snapshot){var progress=snapshot.bytesTransferred/snapshot.totalBytes;setUploadingFiles(function(prev){return prev.map(function(uploadFile){if(uploadFile.id===id){return _objectSpread(_objectSpread({},uploadFile),{},{progress:progress});}return uploadFile;});});},function(){setUploadingFiles(function(prev){return prev.map(function(uploadFile){if(uploadFile.id===id){return _objectSpread(_objectSpread({},uploadFile),{},{error:true});}return uploadFile;});});},function(){setUploadingFiles(function(prev){return prev.filter(function(uploadFile){return uploadFile.id!==id;});});uploadTask.snapshot.ref.getDownloadURL().then(function(url){database.files.where(\"name\",\"==\",file.name).where(\"userId\",\"==\",currentUser.uid).where(\"folderId\",\"==\",currentFolder.id).get().then(function(existingFiles){var existingFile=existingFiles.docs[0];if(existingFile){existingFile.ref.update({url:url});}else{database.files.add({url:url,name:file.name,createdAt:database.getCurrentTimestamp(),folderId:currentFolder.id,userId:currentUser.uid});}});});});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"ml-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-dark rounded flex items-center px-4 py-1 w-full font-base bg-blue-200 hover:bg-stone-900 hover:text-white py-3 px-5 cursor-pointer\",children:[/*#__PURE__*/_jsx(ArrowUpTrayIcon,{className:\"h-5 w-5 mr-1\",\"aria-hidden\":\"true\"}),\"Upload\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:handleUpload,style:{display:\"none\"}})]}),uplaodingFiles.length>0&&/*#__PURE__*/ReactDOM.createPortal(/*#__PURE__*/_jsx(\"div\",{className:\"bg-black border rounded-lg p-2 text-white\",style:{position:\"absolute\",bottom:\"1rem\",right:\"calc(50% - 350px / 2)\",width:\"350px\"},children:uplaodingFiles.length>0&&uplaodingFiles.map(function(file){return/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center mb-4\",children:/*#__PURE__*/_jsx(\"h4\",{className:file.error?\"text-red-800 font-medium text-lg\":\"font-medium text-lg\",children:file.error?\"Error uploading file \".concat(file.name):file.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full dark:bg-gray-700\",children:/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(file.error?\"bg-red-800\":\"bg-blue-600\",\" text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full\"),style:{width:\"\".concat(Math.round(file.progress*100),\"%\")},children:\"\".concat(Math.round(file.progress*100),\"%\")})})]},file.id);})}),document.body)]});};export default AddFileBtn;","map":{"version":3,"names":["React","useEffect","useState","ReactDOM","ArrowUpTrayIcon","storage","useAuth","ROOT_FOLDER","database","v4","uuidV4","AddFileBtn","currentFolder","uplaodingFiles","setUploadingFiles","currentUser","handleUpload","e","file","target","files","id","prev","name","progress","error","currentPath","path","map","u","join","filePath","uploadTask","ref","uid","put","on","snapshot","bytesTransferred","totalBytes","uploadFile","filter","getDownloadURL","then","url","where","get","existingFiles","existingFile","docs","update","add","createdAt","getCurrentTimestamp","folderId","userId","display","length","createPortal","position","bottom","right","width","Math","round","document","body"],"sources":["/Users/student/Desktop/My_dropbox-master/src/components/storage/AddFileBtn.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport ReactDOM  from \"react-dom\";\nimport { ArrowUpTrayIcon } from '@heroicons/react/20/solid';\nimport { storage } from '../../firebase';\nimport { useAuth } from './../store/AuthStore';\nimport { ROOT_FOLDER } from './../hooks/useFolder';\nimport { database } from './../../firebase';\nimport { v4 as uuidV4 } from \"uuid\";\n\nconst AddFileBtn = ({ currentFolder }) => {\n    const [uplaodingFiles, setUploadingFiles] = useState([]);\n    const { currentUser } = useAuth();\n\n    const handleUpload = (e) => {\n        const file = e.target.files[0];\n\n        if(currentFolder === null || !file) return;\n\n        const id = uuidV4();\n        setUploadingFiles(prev => [\n            ...prev,\n            { id: id, name: file.name, progress: 0, error: false }\n        ])\n\n        const currentPath = currentFolder.path.map(u => u.name).join('/');\n\n        const filePath =\n            currentFolder === ROOT_FOLDER\n                ?\n                    `${currentPath}/${file.name}`\n                :\n                    `${currentPath}/${currentFolder.name}/${file.name}`\n\n\n        const uploadTask = storage\n            .ref(`/files/${currentUser.uid}/${filePath}`)\n            .put(file);\n\n\n        uploadTask.on(\"state-changed\", snapshot => {\n            const progress = snapshot.bytesTransferred / snapshot.totalBytes;\n            setUploadingFiles(prev => {\n                return prev.map(uploadFile => {\n                    if(uploadFile.id === id) {\n                        return { ...uploadFile, progress: progress }\n                    }\n\n                    return uploadFile;\n                })\n            });\n        },\n        () => {\n            setUploadingFiles(prev => {\n                return prev.map(uploadFile => {\n                    if(uploadFile.id === id) {\n                        return { ...uploadFile, error: true }\n                    }\n\n                    return uploadFile;\n                })\n            })\n        },\n        () => {\n            setUploadingFiles(prev => {\n                return prev.filter(uploadFile => uploadFile.id !== id)\n            });\n\n            uploadTask.snapshot.ref.getDownloadURL().then(url => {\n                database.files\n                    .where(\"name\", \"==\", file.name)\n                    .where(\"userId\", \"==\", currentUser.uid)\n                    .where(\"folderId\", \"==\", currentFolder.id)\n                    .get()\n                    .then(existingFiles => {\n                        const existingFile = existingFiles.docs[0];\n                        if(existingFile) {\n                            existingFile.ref.update({ url: url  });\n                        } else {\n                            database.files.add({\n                                url: url,\n                                name: file.name,\n                                createdAt: database.getCurrentTimestamp(),\n                                folderId: currentFolder.id,\n                                userId: currentUser.uid\n                            })\n                        }\n                    })\n            })\n        })\n    }\n\n    return (\n        <>\n            <label className=\"ml-4\">\n                <div className=\"text-dark rounded flex items-center px-4 py-1 w-full font-base bg-blue-200 hover:bg-stone-900 hover:text-white py-3 px-5 cursor-pointer\">\n                    <ArrowUpTrayIcon\n                        className=\"h-5 w-5 mr-1\"\n                        aria-hidden=\"true\"\n                    />\n                    Upload\n                </div>\n                <input\n                    type=\"file\"\n                    onChange={handleUpload}\n                    style={{display: \"none\"}}\n                />\n            </label>\n            {   uplaodingFiles.length > 0 &&\n                ReactDOM.createPortal((\n                    <div className=\"bg-black border rounded-lg p-2 text-white\" style={{\n                        position: \"absolute\",\n                        bottom: \"1rem\",\n                        right: \"calc(50% - 350px / 2)\",\n                        width: \"350px\"\n                    }}>\n                        { uplaodingFiles.length > 0 && uplaodingFiles.map(file => (\n                            <div className=\"\" key={file.id}>\n                                <div className=\"text-center mb-4\">\n                                    <h4 className={ file.error ? \"text-red-800 font-medium text-lg\" :  \"font-medium text-lg\"}>\n                                        { file.error ?  `Error uploading file ${file.name}` : file.name }\n                                    </h4>\n                                </div>\n                                <div className=\"w-full bg-gray-200 rounded-full dark:bg-gray-700\">\n                                    <div className={`${file.error ? \"bg-red-800\" : \"bg-blue-600\"} text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full` }\n                                    style={{\n                                        width: `${Math.round( file.progress * 100)}%`\n                                    }}>\n                                        { `${Math.round( file.progress * 100)}%` }\n                                    </div>\n                                </div>\n                            </div>\n                        )) }\n                    </div>\n                    ),\n                    document.body\n                )\n            }\n        </>\n    );\n};\n\nexport default AddFileBtn;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}